<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="map"></div>
    <div class="map-overlay">
      <div id="title"><h4>World No Tobacco Day</h4></div>
      <div id="instructions">
        Select the indicator and gender from the dropdown menus. Click on the
        map to get country-specific information
      </div>

      <div class="select-menu">
        <label class="dropdown">
          <div class="dd-button">Offered free tobacco</div>
          <input type="checkbox" class="dd-input" id="test" />
          <div class="dd-menu"></div>
        </label>

        <label class="dropdown">
          <div class="dd-button2">Total</div>
          <input type="checkbox" class="dd-input" id="test" />
          <div class="gender-menu"></div>
        </label>
      </div>

      <div id="indicator">
        Youths 13-15 ever offered a free cigarette by a tobacco company
        representative
      </div>

      <div class="variable-title">
        <div id="percentagesList"></div>
      </div>
      <div id="legend-block">
        <div id="legend">
          <div>
            <span class="legend-key" style="background-color: #fff28b;"></span
            ><span class="legend-value">Less than 3.0%</span>
          </div>
          <div>
            <span class="legend-key" style="background-color: #daa613;"></span
            ><span class="legend-value">3.1 - 6.0%</span>
          </div>
          <div>
            <span class="legend-key" style="background-color: #d45313;"></span
            ><span class="legend-value">6.1 - 9.0%</span>
          </div>
          <div>
            <span class="legend-key" style="background-color: #9d1319;"></span
            ><span class="legend-value">9.1 - 13.0%</span>
          </div>
          <div>
            <span class="legend-key" style="background-color: #780c22;"></span
            ><span class="legend-value">Greater than 13.0%</span>
          </div>
          <div>
            <span class="legend-key" style="background-color: #ffffff;"></span
            ><span class="legend-value">Data not available</span>
          </div>
        </div>
        <div id="data-information">
          Notes about source information: Lorem ipsum dolor sit amet,
          consectetur adipscing elit, sed do eisumod tempor incididunt ut labore
          et dolore magn aliqua. Ut enim ad minim veiam, qui nostru exercitation
          ullamco laboris nisi ut aliquip ex ea commodo consequat
        </div>
      </div>
      <img src="./images/WHO-Logo.png" alt="WHO-Logo" />
    </div>
    <script>
      mapboxgl.accessToken =
        'pk.eyJ1IjoibWFwYm94LWNvbW11bml0eSIsImEiOiJjazhrbnF1NWIwMHVjM2Zwbmh2OWs2dTI1In0.O8lasZoOGKUihm-HVEZxaQ';
      var map = new mapboxgl.Map({
        container: 'map', //map container
        style: 'mapbox://styles/mapbox-community/cka372tus04oq1imm2rgd636k', // Mapbox style
        center: [34.7, 15.5], // starting position [lng, lat]
        zoom: 1, // starting zoom
      });

      var toggleableLayerIds = [
        'Object with tobacco logo',
        'Favored smoke-free places',
        'Offered free tobacco',
      ];

      toggleableLayerIds.forEach(function (id) {
        var link = document.createElement('a');
        link.href = '#';
        link.className = 'active';
        link.textContent = id;

        link.onclick = toggleLayers;

        var menu = document.querySelector('.dd-menu');
        menu.appendChild(link);

        link.addEventListener('click', function () {
          var dropDown = document.querySelector('.dd-button');
          dropDown.innerHTML = link.textContent;
        });
      });

      function toggleLayers(e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        toggleableLayerIds.forEach(function (layer) {
          if (layer == clickedLayer) {
            map.setLayoutProperty(layer, 'visibility', 'visible');
          } else {
            map.setLayoutProperty(layer, 'visibility', 'none');
          }
        });

        var layerKey = {
          'Offered free tobacco': {
            values: [
              'Less than 3.0%',
              '3.1 - 6.0%',
              '6.1 - 9.0%',
              '9.1 - 13.0%',
              'Greater than 13.0%',
              'Data not available',
            ],
            colors: [
              '#FFF28B',
              '#DAA613',
              '#D45313',
              '#9D1319',
              '#780C22',
              '#ffffff',
            ],
            title: [
              'Youths 13-15 ever offered a free cigarette by a tobacco company representative',
            ],
          },

          'Favored smoke-free places': {
            values: [
              'Less than 45.0%',
              '45.1 - 63.0%',
              '63.1 - 76.0%',
              '76.1 - 86.0%',
              'Greater than 86.0%',
              'Data not available',
            ],
            colors: [
              '#72E6E2',
              '#38C5D1',
              '#09A7C3',
              '#1B88A9',
              '#30678D',
              '#ffffff',
            ],
            title: [
              'Youths 13-15 favored banning smoking in enclosed public places',
            ],
          },

          'Object with tobacco logo': {
            values: [
              'Less than 8.0%',
              '8.1 - 12.0%',
              '12.1 - 15.0%',
              '15.1 - 20.0%',
              'Greater than 20.0%',
              'Data not available',
            ],
            colors: [
              '#FFF28B',
              '#DAA613',
              '#D45313',
              '#9D1319',
              '#780C22',
              '#ffffff',
            ],
            title: [
              'Youths 13-15 had object with a cigarette or tobacco logo on it',
            ],
          },
        };

        toggleableLayerIds.forEach(function () {
          var values = layerKey[clickedLayer].values;
          var colors = layerKey[clickedLayer].colors;
          var title = layerKey[clickedLayer].title;

          var items = '';
          var legend = document.getElementById('legend');
          var variableTitle = document.getElementById('indicator');

          variableTitle.innerHTML = title;

          for (i = 0; i < values.length; i++) {
            var indicator = values[i];
            var color = colors[i];

            var key = `<span class='legend-key' style='background-color:${color}'></span>`;
            var value = `<span class='legend-value'>${indicator}</span>`;
            var item = `<div>${key}${value}</div>`;
            items += item;
          }
          legend.innerHTML = items;
        });

        ///need help simplifying and cleaning up - should erase when selecting a new variable - should say 'no data' if no data exists for this field.

        // for (i = 0; i < toggleableLayerIds.length; i++){
        //   var visibility = map.getLayoutProperty(toggleableLayerIds[i], 'visibility');
        //   if (visibility === 'visible'){
        //     map.on('click', function(e){
        //       console.log(map.queryRenderedFeatures(e.point))
        //     })
        //   }

        // }

        map.on('click', function (e) {
          var fourFields = ['4b-total-per', '4b-boy-per', '4b-girl-per'];
          var threeFields = ['3b-total-per', '3b-boy-per', '3b-girl-per'];
          var twoFields = ['2b-total-per', '2b-boy-per', '2b-girl-per'];

          var percentages = document.getElementById('percentagesList');

          var features = map.queryRenderedFeatures(e.point);
          var country = features[0].properties['GEOUNIT'];

          if (clickedLayer === 'Object with tobacco logo') {
            let total = features[1].properties[fourFields[0]];
            let girl = features[1].properties[fourFields[1]];
            let boy = features[1].properties[fourFields[2]];

            percentages.innerHTML = `<p><b> ${country} </b></p> <p><b>Total:</b> ${total}% </p> <p><b>Girls:</b> ${girl}%</p> <p><b>Boys:</b> ${boy}%</p>`;
          }

          if (clickedLayer == 'Favored smoke-free places') {
            let total = features[1].properties[threeFields[0]];
            let girl = features[1].properties[threeFields[1]];
            let boy = features[1].properties[threeFields[2]];

            percentages.innerHTML = `<p><b> ${country} </b></p> <p><b>Total:</b> ${total}% </p> <p><b>Girls:</b> ${girl}%</p> <p><b>Boys:</b> ${boy}%</p>`;
          }

          if (clickedLayer == 'Offered free tobacco') {
            let total = features[1].properties[twoFields[0]];
            let girl = features[1].properties[twoFields[1]];
            let boy = features[1].properties[twoFields[2]];

            percentages.innerHTML = `<p><b>${country} </b></p> <p><b>Total:</b> ${total}% </p> <p><b>Girls:</b> ${girl}%</p> <p><b>Boys:</b> ${boy}%</p>`;
          }
        });
      }
    </script>
  </body>
</html>
